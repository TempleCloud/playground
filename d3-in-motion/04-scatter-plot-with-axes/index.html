<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <title>Scatter Plot with axes</title>
  </head>
  <body>
    <svg width="960" height="500"></svg>
    <script>
      // margin params
  
      // Create dom svg element references
	  const svg = d3.select('svg');
      const width = svg.attr('width');
      const height = svg.attr('height');

      // Calculate inner elemeemt margin offsets
      const margin = { left: 20, right: 20, top: 20, bottom: 20 };
      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;
      // Add the margin as a group to to the svg element
      const g = svg.append('g')
          .attr('transform', `translate(${margin.left}, ${margin.top})`);

	  // Add X axis and generator function - NB: transform pushes to bottom
      const xScale = d3.scaleLinear();
      const xAxisG = g.append('g')
          .attr('transform', `translate(0, ${innerHeight})`);
      const xAxis = d3.axisBottom().scale(xScale);

      // Add Y axis and generator function
      const yScale = d3.scaleLinear();
      const yAxisG = g.append('g');
      const yAxis = d3.axisLeft().scale(yScale);

      // Define getter functions
      const xValue = d => d.sepalLength;
      const yValue = d => d.petalLength;

      // Define a function that uses the binary '+' operator 
      // to convert the csv string values to numeric values.
      const rowToJSON = d => {
        console.log("row d: " + JSON.stringify(d));
        d.petalLength = +d.petalLength;
        d.petalWidth = +d.petalWidth;
        d.sepalLength = +d.sepalLength;
        d.sepalWidth = +d.sepalWidth;
        console.log("row d2: " + JSON.stringify(d));
        return d;
      };

      d3.csv('iris-data.csv', rowToJSON, data => {
        // create horizontal scale
        xScale
		  // domain is the range of values 0 - max(data)
          .domain(d3.extent(data, xValue))
		  // range is the display element size.
              .range([0, innerWidth]);
        // draw axis  
        xAxisG.call(xAxis);

		// create the vertical scale
        yScale
          .domain(d3.extent(data, yValue))
          // NB: UI element y-axis from top left
		  .range([innerHeight, 0]);
        // draw axis
        yAxisG.call(yAxis);

		// Plot the points in the svg sub group
        g.selectAll('circle').data(data)
          .enter().append('circle')
            .attr('cx', d => xScale(xValue(d)))
            .attr('cy', d => yScale(yValue(d)))
            .attr('r', 5);        
      });
    </script>
  </body>
</html>
